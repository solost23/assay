import{r as e,ah as l,L as a,G as t,ai as o,aj as d,d as n,i as u,M as r,o as s,c as i,N as p,O as c,h as m,f as h,w as f,j as v,F as y,A as g,n as b,V as k,q as C,e as _,t as S,k as V}from"./index.1248482e.js";import{l as w,e as x,g as U,f as T,h as N,i as I,j as R}from"./role.b7334f88.js";import{r as K}from"./dept.58daf09e.js";var D=()=>{const{proxy:n}=t(),u=e(),r=e(),s=e(),i=e(!0),p=e(!1),c=e(),m=e(!0),h=e(!0),f=e(!0),v=e(0),y=e(),g=e(""),b=e(!1),k=e(!1),C=e(),_=e(!1),S=e(),V=e(!1),D=e(),$=e(),z=e(),A=e(),q=e({pageNum:1,pageSize:10,roleName:void 0,roleKey:void 0,status:void 0}),E=e({}),L=e(),O=e(),F=()=>{y.value=[],i.value=!0,w(n.addDateRange(q.value,D.value)).then((e=>{y.value=e.rows,v.value=parseInt(e.total),i.value=!1}))},Y=()=>{var e,l;let a=null==(e=u.value)?void 0:e.getCheckedKeys(),t=null==(l=u.value)?void 0:l.getHalfCheckedKeys();return a.unshift.apply(a,t),a},M=()=>{n.cleanTableSelection(s)},P=()=>{null!=u.value&&u.value.setCheckedKeys([]),C.value=!1,_.value=!1,S.value=!0,V.value=!1,E.value={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},n.resetForm(O)},j=()=>{q.value.pageNum=1,F()};return F(),l("sys_normal_disable").then((e=>{$.value=e.data})),{menuRef:u,loading:i,exportLoading:p,deptRef:r,single:m,multiple:h,showSearch:f,total:v,roleList:y,title:g,open:b,openDataScope:k,menuExpand:C,menuNodeAll:_,deptExpand:S,deptNodeAll:V,dateRange:D,statusOptions:$,dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],menuOptions:z,deptOptions:A,queryParams:q,form:E,defaultProps:{children:"children",label:"label"},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]},formRef:O,queryFormRef:L,getList:F,handleStatusChange:async e=>{n.setTableRowSelected(s,e,!0);let l="0"===e.status?"启用":"停用";await n.$modal.confirm('确认要"'+l+'""'+e.roleName+'"角色吗?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>x(e.roleId,e.status))).then((e=>{200===e.code&&n.$modal.msgSuccess(l+"成功")})).catch((()=>{M(),e.status="0"===e.status?"1":"0"}))},handleQuery:j,resetQuery:()=>{D.value=[],n.resetForm(L),j()},handleSelectionChange:e=>{c.value=e.map((e=>e.roleId)),m.value=1!=e.length,h.value=!e.length},handleCheckedTreeExpand:(e,l)=>{if("menu"===l){let l=z.value;for(let a=0;a<l.length;a++)n.$refs.menuRef.store.nodesMap[l[a].id].expanded=e}else if("dept"===l){let l=A.value;for(let a=0;a<l.length;a++)n.$refs.deptRef.store.nodesMap[l[a].id].expanded=e}},handleCheckedTreeNodeAll:(e,l)=>{var a,t;"menu"===l?null==(a=u.value)||a.setCheckedNodes(e?z.value:[]):"dept"===l&&(null==(t=r.value)||t.setCheckedNodes(e?A.value:[]))},handleCheckedTreeConnect:(e,l)=>{"menu"==l?E.value.menuCheckStrictly=!!e:"dept"==l&&(E.value.deptCheckStrictly=!!e)},handleAdd:()=>{P(),o().then((e=>{200===e.code&&(z.value=e.data)})),b.value=!0,g.value="添加角色"},handleUpdate:e=>{n.setTableRowSelected(s,e,!0),P();const l=e.roleId||c.value[0];l&&U(l).then((e=>{200===e.code&&(e.data.roleSort=parseInt(e.data.roleSort),E.value=e.data,b.value=!0,a((()=>{(e=>d(e).then((e=>{if(200===e.code)return z.value=e.menus,e})))(l).then((e=>{if(200===e.code){e.checkedKeys.forEach((e=>{a((()=>{var l;null==(l=u.value)||l.setChecked(e,!0,!1)}))}))}}))})),g.value="修改角色")}))},dataScopeSelectChange:e=>{var l;"2"!==e&&(null==(l=r.value)||l.setCheckedKeys([]))},handleDataScope:e=>{n.setTableRowSelected(s,e,!0),P(),U(e.roleId).then((l=>{200===l.code&&(k.value=!0,l.data.roleSort=parseInt(l.data.roleSort),E.value=l.data,setTimeout((()=>{a((()=>{var l;(l=e.roleId,K(l).then((e=>{if(200===e.code)return A.value=e.data.depts,e}))).then((e=>{var l;null==(l=r.value)||l.setCheckedKeys(e.data.checkedKeys)}))}))}),100),g.value="分配数据权限")}))},handleAuthUser:e=>{n.$router.push({path:`/system/role-auth/user/${e.roleId}`})},submitForm:()=>{var e;null==(e=O.value)||e.validate((e=>{e&&(void 0!==E.value.roleId?(E.value.menuIds=Y(),T(E.value).then((e=>{200===e.code&&(n.$modal.msgSuccess("修改成功"),b.value=!1,F())}))):(E.value.menuIds=Y(),N(E.value).then((e=>{200===e.code&&(n.$modal.msgSuccess("新增成功"),b.value=!1,F())}))))}))},cleanSelect:M,submitDataScope:()=>{void 0!==E.value.roleId&&(E.value.deptIds=(()=>{var e,l;let a=null==(e=r.value)?void 0:e.getCheckedKeys(),t=null==(l=r.value)?void 0:l.getHalfCheckedKeys();return a.unshift.apply(a,t),a})(),I(E.value).then((e=>{200===e.code&&(n.$modal.msgSuccess("修改成功"),k.value=!1,F())})))},handleDelete:e=>{if(!e||!c.value)return;n.setTableRowSelected(s,e,!0);const l=e.roleId||c.value;l&&n.$modal.confirm('是否确认删除角色编号为"'+l+'"的数据项?').then((()=>R(l))).then((e=>{200===e.code&&(F(),n.$modal.msgSuccess("删除成功"))})).catch((()=>{M()}))},handleExport:()=>{v.value>1e4?n.$modal.confirm("是否确认导出所有角色数据项?","警告",{}).then((()=>{n.download("/system/role/exportByStream",{...q},`角色信息导出${(new Date).getTime()}.xlsx`)})).catch((()=>{})):n.download("/system/role/exportByStream",{...q},`角色信息导出${(new Date).getTime()}.xlsx`)},pageTable:s,checkSelected:e=>"1"!==e.roleId}};const $={class:"app-container"},z=V("新增"),A=V("导出"),q=V("修改"),E=V("删除"),L=_("span",{class:"table_link_text"},"修改",-1),O=_("span",{class:"table_link_text"},"删除",-1),F=_("span",{class:"table_link_text"},"数据权限",-1),Y=_("span",{class:"table_link_text"},"分配用户",-1),M=V("展开/折叠"),P=V("全选/全不选"),j=V("父子联动"),Q={class:"dialog-footer"},B=V("确 定"),H=V("取 消"),G=V("展开/折叠"),J=V("全选/全不选"),W=V("父子联动"),X={class:"dialog-footer"},Z=V("确 定"),ee=V("取 消"),le=n({name:"Role"}),ae=n({...le,setup(e){const{menuRef:l,loading:a,exportLoading:t,deptRef:o,single:d,multiple:n,showSearch:w,total:x,roleList:U,title:T,open:N,openDataScope:I,menuExpand:R,menuNodeAll:K,deptExpand:le,deptNodeAll:ae,dateRange:te,statusOptions:oe,dataScopeOptions:de,menuOptions:ne,deptOptions:ue,queryParams:re,form:se,defaultProps:ie,rules:pe,formRef:ce,queryFormRef:me,getList:he,handleStatusChange:fe,handleQuery:ve,resetQuery:ye,handleSelectionChange:ge,handleCheckedTreeExpand:be,handleCheckedTreeNodeAll:ke,handleCheckedTreeConnect:Ce,handleAdd:_e,handleUpdate:Se,dataScopeSelectChange:Ve,handleDataScope:we,handleAuthUser:xe,submitForm:Ue,cleanSelect:Te,submitDataScope:Ne,handleDelete:Ie,handleExport:Re,pageTable:Ke,checkSelected:De}=D();return(e,D)=>{const $e=u("el-input"),ze=u("el-form-item"),Ae=u("el-option"),qe=u("el-select"),Ee=u("el-date-picker"),Le=u("form-search"),Oe=u("el-form"),Fe=u("el-button"),Ye=u("el-col"),Me=u("right-toolbar"),Pe=u("el-row"),je=u("el-table-column"),Qe=u("status-switch"),Be=u("el-link"),He=u("el-table"),Ge=u("pagination"),Je=u("el-input-number"),We=u("el-radio"),Xe=u("el-radio-group"),Ze=u("el-checkbox"),el=u("el-tree"),ll=u("el-dialog"),al=r("hasPermi"),tl=r("loading");return s(),i("div",$,[p(h(Oe,{model:m(re),ref_key:"queryFormRef",ref:me,inline:!0,"label-width":"70px"},{default:f((()=>[h(ze,{label:"角色名称",prop:"roleName"},{default:f((()=>[h($e,{modelValue:m(re).roleName,"onUpdate:modelValue":D[0]||(D[0]=e=>m(re).roleName=e),placeholder:"请输入角色名称",clearable:"",style:{width:"240px"},onKeyup:D[1]||(D[1]=v((e=>m(ve)()),["enter","native"]))},null,8,["modelValue"])])),_:1}),h(ze,{label:"权限字符",prop:"roleKey"},{default:f((()=>[h($e,{modelValue:m(re).roleKey,"onUpdate:modelValue":D[2]||(D[2]=e=>m(re).roleKey=e),placeholder:"请输入权限字符",clearable:"",style:{width:"240px"},onKeyup:D[3]||(D[3]=v((e=>m(ve)()),["enter","native"])),onChange:D[4]||(D[4]=e=>m(ve)())},null,8,["modelValue"])])),_:1}),h(ze,{label:"状态",prop:"status"},{default:f((()=>[h(qe,{modelValue:m(re).status,"onUpdate:modelValue":D[5]||(D[5]=e=>m(re).status=e),placeholder:"角色状态",clearable:"",onChange:D[6]||(D[6]=e=>m(ve)()),style:{width:"240px"}},{default:f((()=>[(s(!0),i(y,null,g(m(oe),(e=>(s(),b(Ae,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(ze,{label:"创建时间",style:{"font-weight":"bold"}},{default:f((()=>[h(Ee,{modelValue:m(te),"onUpdate:modelValue":D[7]||(D[7]=e=>k(te)?te.value=e:null),style:{width:"240px"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:"",onChange:D[8]||(D[8]=e=>m(ve)())},null,8,["modelValue"])])),_:1}),h(Le,{onReset:D[9]||(D[9]=e=>m(ye)()),onSearch:D[10]||(D[10]=e=>m(ve)())})])),_:1},8,["model"]),[[c,m(w)]]),h(Pe,{gutter:10,class:"mb8"},{default:f((()=>[h(Ye,{span:1.5},{default:f((()=>[p((s(),b(Fe,{type:"primary",plain:"",icon:"plus",size:"small",onClick:m(_e)},{default:f((()=>[z])),_:1},8,["onClick"])),[[al,["system:role:add"]]])])),_:1},8,["span"]),h(Ye,{span:1.5},{default:f((()=>[p((s(),b(Fe,{type:"warning",plain:"",icon:"download",size:"small",onClick:m(Re)},{default:f((()=>[A])),_:1},8,["onClick"])),[[al,["system:role:export"]]])])),_:1},8,["span"]),m(d)?C("",!0):(s(),b(Ye,{key:0,span:1.5},{default:f((()=>[p((s(),b(Fe,{type:"success",plain:"",icon:"edit",size:"small",disabled:m(d),onClick:m(Se)},{default:f((()=>[q])),_:1},8,["disabled","onClick"])),[[al,["system:role:edit"]]])])),_:1},8,["span"])),m(n)?C("",!0):(s(),b(Ye,{key:1,span:1.5},{default:f((()=>[p((s(),b(Fe,{type:"danger",plain:"",icon:"delete",size:"small",loading:m(t),disabled:m(n),onClick:m(Ie)},{default:f((()=>[E])),_:1},8,["loading","disabled","onClick"])),[[al,["system:role:remove"]]])])),_:1},8,["span"])),h(Me,{showSearch:m(w),"onUpdate:showSearch":D[11]||(D[11]=e=>k(w)?w.value=e:null),onQueryTable:m(he)},null,8,["showSearch","onQueryTable"])])),_:1}),p((s(),b(He,{stripe:"",border:"",ref_key:"pageTable",ref:Ke,data:m(U),onSelectionChange:m(ge)},{default:f((()=>[h(je,{type:"selection",width:"55",align:"center",selectable:m(De)},null,8,["selectable"]),h(je,{label:"角色编号",prop:"roleId"}),h(je,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0}),h(je,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0}),h(je,{label:"显示顺序",prop:"roleSort"}),h(je,{label:"备注信息",prop:"remark"}),h(je,{label:"状态",align:"center"},{default:f((e=>[1!==e.row.roleId?(s(),b(Qe,{key:0,"status-data":e.row.status,onHandleChange:l=>m(fe)(e.row)},null,8,["status-data","onHandleChange"])):(s(),b(Qe,{key:1,"status-data":e.row.status,disabled:!0},null,8,["status-data"]))])),_:1}),h(je,{label:"创建时间",align:"center",prop:"createTime"},{default:f((l=>[_("span",null,S(e.dateTimeSub(l.row.createTime)),1)])),_:1}),h(je,{label:"修改时间",align:"center",prop:"updateTime"},{default:f((l=>[_("span",null,S(e.dateTimeSub(l.row.updateTime)),1)])),_:1}),h(je,{label:"操作",align:"center",width:"300","class-name":"small-padding fixed-width"},{default:f((e=>[1!==e.row.roleId?p((s(),b(Be,{key:0,class:"el-link-spacing",underline:!1,size:"small",type:"primary",icon:"edit",onClick:l=>m(Se)(e.row)},{default:f((()=>[L])),_:2},1032,["onClick"])),[[al,["system:role:edit"]]]):C("",!0),1!==e.row.roleId?p((s(),b(Be,{key:1,class:"el-link-spacing",underline:!1,size:"small",type:"danger",icon:"delete",onClick:l=>m(Ie)(e.row)},{default:f((()=>[O])),_:2},1032,["onClick"])),[[al,["system:role:remove"]]]):C("",!0),1!==e.row.roleId?p((s(),b(Be,{key:2,class:"el-link-spacing",underline:!1,size:"small",type:"primary",icon:"circle-check",onClick:l=>m(we)(e.row)},{default:f((()=>[F])),_:2},1032,["onClick"])),[[al,["system:role:edit"]]]):C("",!0),1!==e.row.roleId?p((s(),b(Be,{key:3,type:"primary",icon:"User",class:"el-link-spacing",underline:!1,size:"small",onClick:l=>m(xe)(e.row)},{default:f((()=>[Y])),_:2},1032,["onClick"])),[[al,["system:role:edit"]]]):C("",!0)])),_:1})])),_:1},8,["data","onSelectionChange"])),[[tl,m(a)]]),p(h(Ge,{total:m(x),page:m(re).pageNum,"onUpdate:page":D[12]||(D[12]=e=>m(re).pageNum=e),limit:m(re).pageSize,"onUpdate:limit":D[13]||(D[13]=e=>m(re).pageSize=e),onPagination:m(he)},null,8,["total","page","limit","onPagination"]),[[c,m(x)>0]]),h(ll,{title:m(T),modelValue:m(N),"onUpdate:modelValue":D[26]||(D[26]=e=>k(N)?N.value=e:null),width:"30%","append-to-body":"",draggable:!0,onClose:D[27]||(D[27]=e=>m(Te)())},{footer:f((()=>[_("div",Q,[h(Fe,{type:"primary",onClick:m(Ue)},{default:f((()=>[B])),_:1},8,["onClick"]),h(Fe,{onClick:D[25]||(D[25]=e=>N.value=!1)},{default:f((()=>[H])),_:1})])])),default:f((()=>[h(Oe,{ref_key:"formRef",ref:ce,model:m(se),rules:m(pe),"label-width":"90px"},{default:f((()=>[h(Pe,null,{default:f((()=>[h(Ye,{span:12},{default:f((()=>[h(ze,{label:"角色名称",prop:"roleName"},{default:f((()=>[h($e,{modelValue:m(se).roleName,"onUpdate:modelValue":D[14]||(D[14]=e=>m(se).roleName=e),placeholder:"请输入角色名称",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),h(Ye,{span:12},{default:f((()=>[h(ze,{label:"权限字符",prop:"roleKey"},{default:f((()=>[h($e,{modelValue:m(se).roleKey,"onUpdate:modelValue":D[15]||(D[15]=e=>m(se).roleKey=e),placeholder:"请输入权限字符",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),h(Ye,{span:12},{default:f((()=>[h(ze,{label:"角色顺序",prop:"roleSort"},{default:f((()=>[h(Je,{modelValue:m(se).roleSort,"onUpdate:modelValue":D[16]||(D[16]=e=>m(se).roleSort=e),"controls-position":"right",min:0,style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),h(Ye,{span:12},{default:f((()=>[h(ze,{label:"角色状态"},{default:f((()=>[h(Xe,{modelValue:m(se).status,"onUpdate:modelValue":D[17]||(D[17]=e=>m(se).status=e)},{default:f((()=>[(s(!0),i(y,null,g(m(oe),(e=>(s(),b(We,{key:e.dictValue,label:e.dictValue},{default:f((()=>[V(S(e.dictLabel),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),h(Ye,{span:24},{default:f((()=>[h(ze,{label:"菜单权限"},{default:f((()=>[h(Ze,{modelValue:m(R),"onUpdate:modelValue":D[18]||(D[18]=e=>k(R)?R.value=e:null),onChange:D[19]||(D[19]=e=>m(be)(e,"menu"))},{default:f((()=>[M])),_:1},8,["modelValue"]),h(Ze,{modelValue:m(K),"onUpdate:modelValue":D[20]||(D[20]=e=>k(K)?K.value=e:null),onChange:D[21]||(D[21]=e=>m(ke)(e,"menu"))},{default:f((()=>[P])),_:1},8,["modelValue"]),h(Ze,{modelValue:m(se).menuCheckStrictly,"onUpdate:modelValue":D[22]||(D[22]=e=>m(se).menuCheckStrictly=e),onChange:D[23]||(D[23]=e=>m(Ce)(e,"menu"))},{default:f((()=>[j])),_:1},8,["modelValue"]),h(el,{class:"tree-border",data:m(ne),"show-checkbox":"",ref_key:"menuRef",ref:l,"node-key":"id","check-strictly":!m(se).menuCheckStrictly,"empty-text":"加载中，请稍后",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])])),_:1})])),_:1}),h(Ye,{span:24},{default:f((()=>[h(ze,{label:"备注"},{default:f((()=>[h($e,{modelValue:m(se).remark,"onUpdate:modelValue":D[24]||(D[24]=e=>m(se).remark=e),type:"textarea",autosize:{minRows:4},placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),h(ll,{title:m(T),modelValue:m(I),"onUpdate:modelValue":D[38]||(D[38]=e=>k(I)?I.value=e:null),width:"20%","append-to-body":"",onClose:D[39]||(D[39]=e=>m(Te)())},{footer:f((()=>[_("div",X,[h(Fe,{type:"primary",onClick:m(Ne)},{default:f((()=>[Z])),_:1},8,["onClick"]),h(Fe,{onClick:D[37]||(D[37]=e=>I.value=!1)},{default:f((()=>[ee])),_:1})])])),default:f((()=>[h(Oe,{model:m(se),"label-width":"80px"},{default:f((()=>[h(ze,{label:"角色名称"},{default:f((()=>[h($e,{modelValue:m(se).roleName,"onUpdate:modelValue":D[28]||(D[28]=e=>m(se).roleName=e),disabled:!0},null,8,["modelValue"])])),_:1}),h(ze,{label:"权限字符"},{default:f((()=>[h($e,{modelValue:m(se).roleKey,"onUpdate:modelValue":D[29]||(D[29]=e=>m(se).roleKey=e),disabled:!0},null,8,["modelValue"])])),_:1}),h(ze,{label:"权限范围"},{default:f((()=>[h(qe,{modelValue:m(se).dataScope,"onUpdate:modelValue":D[30]||(D[30]=e=>m(se).dataScope=e),onChange:m(Ve)},{default:f((()=>[(s(!0),i(y,null,g(m(de),(e=>(s(),b(Ae,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),p(h(ze,{label:"数据权限"},{default:f((()=>[h(Ze,{modelValue:m(le),"onUpdate:modelValue":D[31]||(D[31]=e=>k(le)?le.value=e:null),onChange:D[32]||(D[32]=e=>m(be)(e,"dept"))},{default:f((()=>[G])),_:1},8,["modelValue"]),h(Ze,{modelValue:m(ae),"onUpdate:modelValue":D[33]||(D[33]=e=>k(ae)?ae.value=e:null),onChange:D[34]||(D[34]=e=>m(ke)(e,"dept"))},{default:f((()=>[J])),_:1},8,["modelValue"]),h(Ze,{modelValue:m(se).deptCheckStrictly,"onUpdate:modelValue":D[35]||(D[35]=e=>m(se).deptCheckStrictly=e),onChange:D[36]||(D[36]=e=>m(Ce)(e,"dept"))},{default:f((()=>[W])),_:1},8,["modelValue"]),h(el,{class:"tree-border",data:m(ue),"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:o,"node-key":"id","check-strictly":!m(se).deptCheckStrictly,"empty-text":"加载中，请稍后",props:m(ie)},null,8,["data","check-strictly","props"])])),_:1},512),[[c,2==m(se).dataScope]])])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}}});export{ae as default};
