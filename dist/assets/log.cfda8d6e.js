import{I as e,b as a,r as l,G as o,d as t,i as n,M as s,o as d,c as i,f as u,w as r,N as p,O as c,h as m,j as b,F as g,A as h,n as f,V as _,W as w,q as v,e as y,t as j,k}from"./index.1248482e.js";const C=async a=>await e({url:"/monitor/jobLog/"+a,method:"delete"});var x=()=>{a();const{proxy:t}=o(),{sys_job_group:n,sys_job_status:s}=t.useDict("sys_job_group","sys_job_status"),d=l(!0),i=l(!1);let u=[];const r=l(!1),p=l(!0),c=l(0),m=l([]),b=l(!1),g=l(),h=l({}),f=l({pageNum:1,pageSize:10,jobName:void 0,jobGroup:void 0,status:void 0}),_=l(),w=()=>{d.value=!0,(async a=>await e({url:"/monitor/jobLog/list",method:"get",params:a}))(t.addDateRange(f.value,g.value)).then((e=>{m.value=e.rows,c.value=parseInt(e.total),d.value=!1}))},v=()=>{f.value.pageNum=1,w()},y=()=>{t.cleanTableSelection(_)};return w(),{loading:d,exportLoading:i,multiple:r,showSearch:p,total:c,jobLogList:m,open:b,dateRange:g,formData:h,queryParams:f,sys_job_group:n,sys_job_status:s,pageTableRef:_,getList:w,handleClose:()=>{t.$router.push({path:"/monitor/job"})},handleQuery:v,resetQuery:()=>{g.value=[],t.resetForm("queryForm"),v()},handleSelectionChange:e=>{u=e.map((e=>e.jobLogId)),r.value=!e.length},handleView:e=>{b.value=!0,h.value=e,t.setTableRowSelected(_,e,!0)},handleDelete:()=>{t.$modal.confirm('是否确认删除调度日志编号为"'+u+'"的数据项？').then((()=>C(u))).then((e=>{200===e.code&&(w(),t.$modal.msgSuccess("删除成功"))})).catch((()=>{y()}))},handleDeleteOne:e=>{t.setTableRowSelected(_,e,!0),u.push(e.jobId);const a=u;t.$modal.confirm('是否确认删除调度日志编号为"【'+e.jobId+'】"的数据项？').then((()=>C(a))).then((e=>{200===e.code&&(w(),t.$modal.msgSuccess("删除成功"))})).catch((()=>{y()}))},handleClean:()=>{t.$modal.confirm("是否确认清空所有调度日志数据项?","警告").then((()=>(async()=>await e({url:"/monitor/jobLog/clean",method:"delete"}))())).then((e=>{200===e.code&&(w(),t.$modal.msgSuccess("清空成功"))})).catch((()=>{}))},handleExport:()=>{t.download("/monitor/jobLog/exportByStream",{...f},`调度日志导出${(new Date).getTime()}.xlsx`)},cleanSelect:y}};const S={class:"app-container"},V=k("删除"),L=k("清空"),T=k("导出"),D=k("关闭"),N=y("span",{class:"table_link_text"},"详细",-1),z=y("span",{class:"table_link_text"},"删除",-1),R={key:0},G={key:1},I={class:"dialog-footer"},U=k("关 闭"),Y=t({name:"JobLog"}),$=t({...Y,setup(e){const{loading:a,exportLoading:l,multiple:o,showSearch:t,total:C,jobLogList:Y,open:$,dateRange:q,formData:M,queryParams:P,sys_job_group:Q,sys_job_status:F,pageTableRef:O,getList:E,handleClose:A,handleQuery:B,resetQuery:J,handleSelectionChange:K,handleView:W,handleDelete:H,handleDeleteOne:X,handleClean:Z,handleExport:ee,cleanSelect:ae}=x();return(e,x)=>{const le=n("el-input"),oe=n("el-form-item"),te=n("el-option"),ne=n("el-select"),se=n("el-date-picker"),de=n("form-search"),ie=n("el-form"),ue=n("el-button"),re=n("el-col"),pe=n("right-toolbar"),ce=n("el-row"),me=n("el-table-column"),be=n("dict-tag"),ge=n("el-link"),he=n("el-table"),fe=n("pagination"),_e=n("el-dialog"),we=s("hasPermi"),ve=s("loading");return d(),i("div",S,[u(w,{name:"fade"},{default:r((()=>[p(u(ie,{model:m(P),ref:"queryForm",inline:!0,"label-width":"68px"},{default:r((()=>[u(oe,{label:"任务名称",prop:"jobName"},{default:r((()=>[u(le,{modelValue:m(P).jobName,"onUpdate:modelValue":x[0]||(x[0]=e=>m(P).jobName=e),placeholder:"请输入任务名称",clearable:"",style:{width:"240px"},onKeyup:x[1]||(x[1]=b((e=>m(B)()),["enter","native"])),onChange:x[2]||(x[2]=e=>m(B)())},null,8,["modelValue"])])),_:1}),u(oe,{label:"任务组名",prop:"jobGroup"},{default:r((()=>[u(ne,{modelValue:m(P).jobGroup,"onUpdate:modelValue":x[3]||(x[3]=e=>m(P).jobGroup=e),placeholder:"请选中组名",clearable:"",style:{width:"240px"},onChange:x[4]||(x[4]=e=>m(B)())},{default:r((()=>[(d(!0),i(g,null,h(m(Q),(e=>(d(),f(te,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(oe,{label:"执行状态",prop:"status"},{default:r((()=>[u(ne,{modelValue:m(P).status,"onUpdate:modelValue":x[5]||(x[5]=e=>m(P).status=e),placeholder:"请选择执行状态",clearable:"",style:{width:"240px"},onChange:x[6]||(x[6]=e=>m(B)())},{default:r((()=>[(d(!0),i(g,null,h(m(F),(e=>(d(),f(te,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(oe,{label:"执行时间"},{default:r((()=>[u(se,{modelValue:m(q),"onUpdate:modelValue":x[7]||(x[7]=e=>_(q)?q.value=e:null),style:{width:"240px"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:x[8]||(x[8]=e=>m(B)())},null,8,["modelValue"])])),_:1}),u(de,{onReset:x[9]||(x[9]=e=>m(J)()),onSearch:x[10]||(x[10]=e=>m(B)())})])),_:1},8,["model"]),[[c,m(t)]])])),_:1}),u(ce,{gutter:10,class:"mb8"},{default:r((()=>[m(o)?v("",!0):(d(),f(re,{key:0,span:1.5},{default:r((()=>[p((d(),f(ue,{type:"danger",plain:"",icon:"delete",size:"small",disabled:m(o),onClick:m(H)},{default:r((()=>[V])),_:1},8,["disabled","onClick"])),[[we,["monitor:job:remove"]]])])),_:1},8,["span"])),u(re,{span:1.5},{default:r((()=>[p((d(),f(ue,{type:"danger",plain:"",icon:"delete",size:"small",onClick:m(Z)},{default:r((()=>[L])),_:1},8,["onClick"])),[[we,["monitor:job:remove"]]])])),_:1},8,["span"]),u(re,{span:1.5},{default:r((()=>[p((d(),f(ue,{type:"warning",plain:"",icon:"download",size:"small",loading:m(l),onClick:m(ee)},{default:r((()=>[T])),_:1},8,["loading","onClick"])),[[we,["monitor:job:export"]]])])),_:1},8,["span"]),u(re,{span:1.5},{default:r((()=>[u(ue,{type:"warning",plain:"",icon:"close",size:"small",onClick:m(A)},{default:r((()=>[D])),_:1},8,["onClick"])])),_:1},8,["span"]),u(pe,{showSearch:m(t),"onUpdate:showSearch":x[11]||(x[11]=e=>_(t)?t.value=e:null),onQueryTable:x[12]||(x[12]=e=>m(E)())},null,8,["showSearch"])])),_:1}),p((d(),f(he,{scripe:"",border:"",height:"560px",ref_key:"pageTableRef",ref:O,data:m(Y),onSelectionChange:m(K)},{default:r((()=>[u(me,{type:"selection",width:"55",align:"center"}),u(me,{label:"日志编号",width:"100",align:"center",prop:"jobLogId"}),u(me,{label:"任务名称",align:"center",width:"300",prop:"jobName","show-overflow-tooltip":!0}),u(me,{label:"任务组名",align:"center",width:"200",prop:"jobGroup","show-overflow-tooltip":!0},{default:r((e=>[u(be,{options:m(Q),value:e.row.jobGroup},null,8,["options","value"])])),_:1}),u(me,{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),u(me,{label:"日志信息",align:"center",prop:"jobMessage","show-overflow-tooltip":!0}),u(me,{label:"执行状态",align:"center",prop:"status",width:"200"},{default:r((e=>[u(be,{options:m(F),value:e.row.status},null,8,["options","value"])])),_:1}),u(me,{label:"执行时间",align:"center",prop:"createTime",width:"200"},{default:r((a=>[y("span",null,j(e.parseTime(a.row.createTime)),1)])),_:1}),u(me,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"250"},{default:r((e=>[p((d(),f(ge,{class:"table_link_btn",underline:!1,size:"small",type:"primary",icon:"view",onClick:a=>m(W)(e.row)},{default:r((()=>[N])),_:2},1032,["onClick"])),[[we,["monitor:job:query"]]]),p((d(),f(ge,{class:"table_link_btn",underline:!1,size:"small",type:"danger",icon:"delete",onClick:a=>m(X)(e.row)},{default:r((()=>[z])),_:2},1032,["onClick"])),[[we,["monitor:job:query"]]])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[ve,m(a)]]),p(u(fe,{total:m(C),page:m(P).pageNum,"onUpdate:page":x[13]||(x[13]=e=>m(P).pageNum=e),limit:m(P).pageSize,"onUpdate:limit":x[14]||(x[14]=e=>m(P).pageSize=e),onPagination:m(E)},null,8,["total","page","limit","onPagination"]),[[c,m(C)>0]]),u(_e,{title:"调度日志详细",modelValue:m($),"onUpdate:modelValue":x[16]||(x[16]=e=>_($)?$.value=e:null),width:"30%","append-to-body":"",onClose:x[17]||(x[17]=e=>m(ae)())},{footer:r((()=>[y("div",I,[u(ue,{onClick:x[15]||(x[15]=e=>$.value=!1)},{default:r((()=>[U])),_:1})])])),default:r((()=>[u(ie,{ref:"formRef",model:m(M),"label-width":"100px",size:"small"},{default:r((()=>[u(ce,null,{default:r((()=>[u(re,{span:12},{default:r((()=>[u(oe,{label:"日志序号："},{default:r((()=>[k(j(m(M).jobLogId),1)])),_:1}),u(oe,{label:"任务名称："},{default:r((()=>[k(j(m(M).jobName),1)])),_:1})])),_:1}),u(re,{span:12},{default:r((()=>[u(oe,{label:"任务分组："},{default:r((()=>[k(j(m(M).jobGroup),1)])),_:1}),u(oe,{label:"执行时间："},{default:r((()=>[k(j(m(M).createTime),1)])),_:1})])),_:1}),u(re,{span:24},{default:r((()=>[u(oe,{label:"调用方法："},{default:r((()=>[k(j(m(M).invokeTarget),1)])),_:1})])),_:1}),u(re,{span:24},{default:r((()=>[u(oe,{label:"日志信息："},{default:r((()=>[k(j(m(M).jobMessage),1)])),_:1})])),_:1}),u(re,{span:24},{default:r((()=>[u(oe,{label:"执行状态："},{default:r((()=>[0==m(M).status?(d(),i("div",R,"正常")):1==m(M).status?(d(),i("div",G,"失败")):v("",!0)])),_:1})])),_:1}),u(re,{span:24},{default:r((()=>[1==m(M).status?(d(),f(oe,{key:0,label:"异常信息："},{default:r((()=>[k(j(m(M).exceptionInfo),1)])),_:1})):v("",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}});export{$ as default};
