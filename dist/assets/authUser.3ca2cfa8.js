import{d as e,K as l,r as a,B as o,i as t,M as n,o as r,c as s,N as u,O as i,f as p,w as d,j as c,n as m,h as f,e as h,t as b,k as g,G as v}from"./index.1248482e.js";import w from"./selectUser.411f976f.js";import{a as y,b as _,c as C}from"./role.b7334f88.js";const I={class:"app-container"},N=g("搜索"),k=g("重置"),S=g("添加用户"),x=g("批量取消授权"),U=g("关闭"),V=g("取消授权"),$=e({name:"AuthUser"}),j=e({...$,setup(e){const g=l(),{proxy:$}=v(),{sys_normal_disable:j}=$.useDict("sys_normal_disable"),K=a([]),R=a(!0),P=a(!0),T=a(!0),z=a(0),O=a([]),q=o({pageNum:1,pageSize:10,roleId:g.params.roleId,userName:void 0,phonenumber:void 0});function A(){R.value=!0,y(q).then((e=>{K.value=e.rows,z.value=e.total,R.value=!1}))}function B(){$.$tab.closeOpenPage({path:"/system/role"})}function D(){q.pageNum=1,A()}function F(){$.resetForm("queryRef"),D()}function G(e){O.value=e.map((e=>e.userId)),T.value=!e.length}function M(){$.$refs.selectRef.show()}function Q(e){const l=q.roleId,a=O.value.join(",");$.$modal.confirm("是否取消选中用户授权数据项?").then((function(){return C({roleId:l,userIds:a})})).then((()=>{A(),$.$modal.msgSuccess("取消授权成功")})).catch((()=>{}))}return A(),(e,l)=>{const a=t("el-input"),o=t("el-form-item"),g=t("el-button"),v=t("el-form"),y=t("el-col"),C=t("right-toolbar"),O=t("el-row"),E=t("el-table-column"),H=t("dict-tag"),J=t("el-table"),L=t("pagination"),W=n("hasPermi"),X=n("loading");return r(),s("div",I,[u(p(v,{model:q,ref:"queryRef",inline:!0},{default:d((()=>[p(o,{label:"用户名称",prop:"userName"},{default:d((()=>[p(a,{modelValue:q.userName,"onUpdate:modelValue":l[0]||(l[0]=e=>q.userName=e),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:c(D,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),p(o,{label:"手机号码",prop:"phonenumber"},{default:d((()=>[p(a,{modelValue:q.phonenumber,"onUpdate:modelValue":l[1]||(l[1]=e=>q.phonenumber=e),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:c(D,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),p(o,null,{default:d((()=>[p(g,{type:"primary",icon:"Search",onClick:D},{default:d((()=>[N])),_:1}),p(g,{icon:"Refresh",onClick:F},{default:d((()=>[k])),_:1})])),_:1})])),_:1},8,["model"]),[[i,P.value]]),p(O,{gutter:10,class:"mb8"},{default:d((()=>[p(y,{span:1.5},{default:d((()=>[u((r(),m(g,{type:"primary",plain:"",icon:"Plus",onClick:M},{default:d((()=>[S])),_:1})),[[W,["system:role:add"]]])])),_:1},8,["span"]),p(y,{span:1.5},{default:d((()=>[u((r(),m(g,{type:"danger",plain:"",icon:"CircleClose",disabled:T.value,onClick:Q},{default:d((()=>[x])),_:1},8,["disabled"])),[[W,["system:role:remove"]]])])),_:1},8,["span"]),p(y,{span:1.5},{default:d((()=>[p(g,{type:"warning",plain:"",icon:"Close",onClick:B},{default:d((()=>[U])),_:1})])),_:1},8,["span"]),p(C,{showSearch:P.value,"onUpdate:showSearch":l[2]||(l[2]=e=>P.value=e),onQueryTable:A},null,8,["showSearch"])])),_:1}),u((r(),m(J,{data:K.value,onSelectionChange:G},{default:d((()=>[p(E,{type:"selection",width:"55",align:"center"}),p(E,{label:"用户名称",prop:"userName","show-overflow-tooltip":!0}),p(E,{label:"用户昵称",prop:"nickName","show-overflow-tooltip":!0}),p(E,{label:"邮箱",prop:"email","show-overflow-tooltip":!0}),p(E,{label:"手机",prop:"phonenumber","show-overflow-tooltip":!0}),p(E,{label:"状态",align:"center",prop:"status"},{default:d((e=>[p(H,{options:f(j),value:e.row.status},null,8,["options","value"])])),_:1}),p(E,{label:"创建时间",align:"center",prop:"createTime",width:"180"},{default:d((l=>[h("span",null,b(e.parseTime(l.row.createTime)),1)])),_:1}),p(E,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:d((e=>[u((r(),m(g,{type:"text",icon:"CircleClose",onClick:l=>{return a=e.row,void $.$modal.confirm('确认要取消该用户"'+a.userName+'"角色吗？').then((function(){return _({userId:a.userId,roleId:q.roleId})})).then((()=>{A(),$.$modal.msgSuccess("取消授权成功")})).catch((()=>{}));var a}},{default:d((()=>[V])),_:2},1032,["onClick"])),[[W,["system:role:remove"]]])])),_:1})])),_:1},8,["data"])),[[X,R.value]]),u(p(L,{total:z.value,page:q.pageNum,"onUpdate:page":l[3]||(l[3]=e=>q.pageNum=e),limit:q.pageSize,"onUpdate:limit":l[4]||(l[4]=e=>q.pageSize=e),onPagination:A},null,8,["total","page","limit"]),[[i,z.value>0]]),p(w,{ref:"selectRef",roleId:q.roleId,onOk:D},null,8,["roleId"])])}}});export{j as default};
