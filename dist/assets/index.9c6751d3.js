import{I as e,r as l,z as a,G as t,d as o,i as n,M as s,o as r,c as d,N as i,O as p,h as u,f as c,w as m,j as g,F as f,A as h,n as _,V as b,q as y,e as w,t as v,k}from"./index.1248482e.js";var C=()=>{const{proxy:o}=t(),n=l(!0),s=l(!1);let r=[];const d=l(!0),i=l(!0),p=l(0),u=l(),c=l(!1),m=l(""),g={prop:"operTime",order:"descending"};let f=l();const h=l({pageNum:1,pageSize:10,title:void 0,operName:void 0,businessType:void 0,status:void 0}),{sys_common_status:_}=o.useDict("sys_common_status"),{sys_oper_type:b}=o.useDict("sys_oper_type"),y=l(),w=l(),v=l(),k=l(),C=()=>{n.value=!0,(async l=>await e({url:"/monitor/operlog/list",method:"get",params:l}))(o.addDateRange(h.value,m.value)).then((e=>{200===e.code&&(u.value=e.rows,p.value=parseInt(e.total),n.value=!1)}))},S=()=>{h.value.pageNum=1,C()},x=()=>{o.cleanTableSelection(k)};return a((()=>{C(),o.getDicts("sys_normal_disable").then((e=>{v.value=e.data})),document.onkeydown=e=>{if(e.defaultPrevented)return;const l=document.getElementsByTagName("body")[0];13===e.keyCode&&e.target.baseURI.match("/system/log/operlog")&&e.target===l&&C()}})),{loading:n,exportLoading:s,multiple:d,showSearch:i,total:p,list:u,open:c,dateRange:m,defaultSort:g,form:f,queryParams:h,sys_common_status:_,sys_oper_type:b,formRef:y,statusOptions:v,queryForm:w,pageTableRef:k,cleanSelect:x,getList:C,typeFormat:e=>o.selectDictLabel(b.value,e.businessType),handleQuery:S,resetQuery:()=>{m.value="",o.resetForm(w),o.$refs.tables.sort(g.prop,g.order),S()},handleSelectionChange:e=>{r=e.map((e=>e.operId)),d.value=!e.length},handleSortChange:e=>{h.value.orderByColumn=e.prop,h.value.isAsc=e.order,C()},handleView:e=>{o.setTableRowSelected(k,e,!0),c.value=!0,f.value=e},handleDelete:l=>{o.setTableRowSelected(k,l,!0);const a=l.operId||r;o.$modal.confirm('是否确认删除日志编号为"'+a+'"的数据项?',"警告").then((()=>(async l=>await e({url:"/monitor/operlog/"+l,method:"delete"}))(a))).then((e=>{200===e.code&&(C(),o.$modal.msgSuccess("删除成功"))})).catch((()=>{x()}))},handleClean:()=>{o.$modal.confirm("是否确认清空所有操作日志数据项?","警告").then((()=>(async()=>await e({url:"/monitor/operlog/clean",method:"delete"}))())).then((e=>{200===e.code&&(C(),o.$modal.msgSuccess("清空成功"))})).catch((()=>{}))},handleExport:()=>{o.download("/monitor/operlog/exportByStream",{...h},`操作日志导出${(new Date).getTime()}.xlsx`)}}};const S={class:"app-container"},x=k("重置"),T=k("搜索"),V=k("清空"),R=k("导出"),D=k("删除"),N=w("span",{class:"table_link_text"},"详细",-1),U=w("span",{class:"table_link_text"},"删除",-1),q={style:{color:"#FFA500","font-size":"16px"}},F={class:"dialog-footer"},z=k("关 闭"),I=o({name:"OperaLog"}),L=o({...I,setup(e){const{loading:l,exportLoading:a,multiple:t,showSearch:o,total:I,list:L,open:M,dateRange:Y,defaultSort:P,form:$,queryParams:Q,sys_common_status:H,sys_oper_type:j,formRef:A,queryForm:B,getList:E,typeFormat:O,handleQuery:K,resetQuery:G,handleSelectionChange:J,handleSortChange:W,handleView:X,handleDelete:Z,handleClean:ee,handleExport:le,pageTableRef:ae,cleanSelect:te}=C();return(e,C)=>{const oe=n("el-input"),ne=n("el-form-item"),se=n("el-option"),re=n("el-select"),de=n("el-date-picker"),ie=n("el-button"),pe=n("el-form"),ue=n("el-col"),ce=n("right-toolbar"),me=n("el-row"),ge=n("el-table-column"),fe=n("dict-tag"),he=n("el-link"),_e=n("el-table"),be=n("pagination"),ye=n("el-tag"),we=n("el-dialog"),ve=s("hasPermi"),ke=s("loading");return r(),d("div",S,[i(c(pe,{model:u(Q),ref_key:"queryForm",ref:B,inline:!0,"label-width":"70px"},{default:m((()=>[c(ne,{label:"系统模块",prop:"title"},{default:m((()=>[c(oe,{modelValue:u(Q).title,"onUpdate:modelValue":C[0]||(C[0]=e=>u(Q).title=e),placeholder:"请输入系统模块",clearable:"",style:{width:"240px"},onKeyup:C[1]||(C[1]=g((e=>u(K)()),["enter","native"]))},null,8,["modelValue"])])),_:1}),c(ne,{label:"操作人员",prop:"operName"},{default:m((()=>[c(oe,{modelValue:u(Q).operName,"onUpdate:modelValue":C[2]||(C[2]=e=>u(Q).operName=e),placeholder:"请输入操作人员",clearable:"",style:{width:"240px"},onKeyup:C[3]||(C[3]=g((e=>u(K)()),["enter","native"]))},null,8,["modelValue"])])),_:1}),c(ne,{label:"类型",prop:"businessType"},{default:m((()=>[c(re,{modelValue:u(Q).businessType,"onUpdate:modelValue":C[4]||(C[4]=e=>u(Q).businessType=e),placeholder:"操作类型",clearable:"",onChange:C[5]||(C[5]=e=>u(K)()),style:{width:"240px"}},{default:m((()=>[(r(!0),d(f,null,h(u(j),((e,l)=>(r(),_(se,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(ne,{label:"状态",prop:"status"},{default:m((()=>[c(re,{modelValue:u(Q).status,"onUpdate:modelValue":C[6]||(C[6]=e=>u(Q).status=e),placeholder:"操作状态",clearable:"",onChange:C[7]||(C[7]=e=>u(K)()),style:{width:"240px"}},{default:m((()=>[(r(!0),d(f,null,h(u(H),((e,l)=>(r(),_(se,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(ne,{label:"操作时间",style:{"font-weight":"bold"}},{default:m((()=>[c(de,{modelValue:u(Y),"onUpdate:modelValue":C[8]||(C[8]=e=>b(Y)?Y.value=e:null),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",onChange:C[9]||(C[9]=e=>u(K)())},null,8,["modelValue"])])),_:1}),c(ne,{class:"item-search"},{default:m((()=>[c(ie,{icon:"refresh",onClick:C[10]||(C[10]=e=>u(G)())},{default:m((()=>[x])),_:1}),c(ie,{type:"primary",icon:"search",onClick:C[11]||(C[11]=e=>u(K)())},{default:m((()=>[T])),_:1})])),_:1})])),_:1},8,["model"]),[[p,u(o)]]),c(me,{gutter:10,class:"mb8"},{default:m((()=>[c(ue,{span:1.5},{default:m((()=>[i((r(),_(ie,{type:"danger",plain:"",icon:"delete",size:"small",onClick:u(ee)},{default:m((()=>[V])),_:1},8,["onClick"])),[[ve,["monitor:operlog:remove"]]])])),_:1},8,["span"]),c(ue,{span:1.5},{default:m((()=>[i((r(),_(ie,{type:"warning",plain:"",icon:"download",size:"small",loading:u(a),onClick:u(le)},{default:m((()=>[R])),_:1},8,["loading","onClick"])),[[ve,["monitor:operlog:export"]]])])),_:1},8,["span"]),u(t)?y("",!0):(r(),_(ue,{key:0,span:1.5},{default:m((()=>[i((r(),_(ie,{type:"danger",plain:"",icon:"delete",size:"small",disabled:u(t),onClick:u(Z)},{default:m((()=>[D])),_:1},8,["disabled","onClick"])),[[ve,["monitor:operlog:remove"]]])])),_:1},8,["span"])),c(ce,{showSearch:u(o),"onUpdate:showSearch":C[12]||(C[12]=e=>b(o)?o.value=e:null),onQueryTable:C[13]||(C[13]=e=>u(E)())},null,8,["showSearch"])])),_:1}),i((r(),_(_e,{stripe:"",border:"",ref_key:"pageTableRef",ref:ae,data:u(L),height:"560",onSelectionChange:u(J),"default-sort":u(P),onSortChange:u(W)},{default:m((()=>[c(ge,{type:"selection",width:"55",align:"center"}),c(ge,{label:"日志编号",align:"center",prop:"operId",width:"150"}),c(ge,{label:"系统模块",align:"center",prop:"title"}),c(ge,{label:"操作类型",align:"center",prop:"businessType"},{default:m((e=>[c(fe,{options:u(j),value:e.row.businessType},null,8,["options","value"])])),_:1}),c(ge,{label:"请求方式",align:"center",prop:"requestMethod"}),c(ge,{label:"操作人员",align:"center",prop:"operName",width:"200","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]}),c(ge,{label:"操作地址",align:"center",prop:"operIp",width:"200","show-overflow-tooltip":!0}),c(ge,{label:"操作地点",align:"center",prop:"operLocation","show-overflow-tooltip":!0}),c(ge,{label:"操作状态",align:"center",prop:"status",width:"200"},{default:m((e=>[c(fe,{options:u(H),value:e.row.status},null,8,["options","value"])])),_:1}),c(ge,{label:"操作日期",align:"center",prop:"operTime",sortable:"custom","sort-orders":["descending","ascending"],width:"200"},{default:m((e=>[w("span",null,v(e.row.operTime),1)])),_:1}),c(ge,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"200"},{default:m((e=>[i((r(),_(he,{type:"primary",class:"table_link_btn",underline:!1,icon:"view",onClick:l=>u(X)(e.row),title:"点击查看详情"},{default:m((()=>[N])),_:2},1032,["onClick"])),[[ve,["monitor:operlog:query"]]]),i((r(),_(he,{class:"table_link_btn",underline:!1,type:"danger",icon:"delete",onClick:l=>u(Z)(e.row)},{default:m((()=>[U])),_:2},1032,["onClick"])),[[ve,["monitor:operlog:query"]]])])),_:1})])),_:1},8,["data","onSelectionChange","default-sort","onSortChange"])),[[ke,u(l)]]),i(c(be,{total:u(I),page:u(Q).pageNum,"onUpdate:page":C[14]||(C[14]=e=>u(Q).pageNum=e),limit:u(Q).pageSize,"onUpdate:limit":C[15]||(C[15]=e=>u(Q).pageSize=e),onPagination:C[16]||(C[16]=e=>u(E)())},null,8,["total","page","limit"]),[[p,u(I)>0]]),c(we,{title:"操作日志详细",modelValue:u(M),"onUpdate:modelValue":C[18]||(C[18]=e=>b(M)?M.value=e:null),width:"40%","append-to-body":"",onClose:C[19]||(C[19]=e=>u(te)())},{footer:m((()=>[w("div",F,[c(ie,{onClick:C[17]||(C[17]=e=>M.value=!1)},{default:m((()=>[z])),_:1})])])),default:m((()=>[c(pe,{ref_key:"formRef",ref:A,model:u($),"label-width":"100px"},{default:m((()=>[c(me,null,{default:m((()=>[c(ue,{span:12},{default:m((()=>[c(ne,{label:"操作模块：","show-overflow-tooltip":!0},{default:m((()=>[k(v(u($).title)+" / "+v(u(O)(u($))),1)])),_:1}),c(ne,{label:"登录信息：","show-overflow-tooltip":!0},{default:m((()=>[k(v(u($).operName)+" / "+v(u($).operIp)+" / "+v(u($).operLocation),1)])),_:1})])),_:1}),c(ue,{span:12},{default:m((()=>[c(ne,{label:"请求地址："},{default:m((()=>[k(v(u($).operUrl),1)])),_:1}),c(ne,{label:"请求方式："},{default:m((()=>[k(v(u($).requestMethod),1)])),_:1})])),_:1}),c(ue,{span:24},{default:m((()=>[c(ne,{label:"操作方法："},{default:m((()=>[k(v(u($).method),1)])),_:1})])),_:1}),c(ue,{span:24},{default:m((()=>[c(ne,{label:"请求参数："},{default:m((()=>[k(v(u($).operParam),1)])),_:1})])),_:1}),c(ue,{span:24},{default:m((()=>[c(ne,{label:"返回参数："},{default:m((()=>[k(v(u($).jsonResult),1)])),_:1})])),_:1}),c(ue,{span:12},{default:m((()=>[c(ne,{label:"操作状态："},{default:m((()=>[c(ye,{class:"ml-2",type:0===u($).status?"success":"danger"},{default:m((()=>[k(v(0===u($).status?"正常":"失败"),1)])),_:1},8,["type"])])),_:1})])),_:1}),c(ue,{span:12},{default:m((()=>[c(ne,{label:"操作时间："},{default:m((()=>[k(v(e.parseTime(u($).operTime)),1)])),_:1})])),_:1}),c(ue,{span:24},{default:m((()=>[1===u($).status?(r(),_(ne,{key:0,label:"异常信息："},{default:m((()=>[w("span",q,v(u($).errorMsg),1)])),_:1})):y("",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}});export{L as default};
